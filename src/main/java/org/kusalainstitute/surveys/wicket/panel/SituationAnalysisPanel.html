<!DOCTYPE html>
<html xmlns:wicket="http://wicket.apache.org">
<head>
<wicket:head>
	<style>
/* Scrolling Container */
.situation-table-wrapper {
	width: 100%;
	overflow-x: auto;
	overflow-y: auto;
	max-height: 90vh;
	box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
	border: 1px solid #dee2e6;
	margin-bottom: 20px;
}

.situation-table {
	border-collapse: separate;
	border-spacing: 0;
	width: 100%;
	font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
		Helvetica, Arial, sans-serif;
	font-size: 13px;
	min-width: 6500px;
	/* Wide enough for 33 situation columns + 13 text columns + student */
}

/* Sticky Column Setup */
.situation-table th.sticky-col, .situation-table td.sticky-col {
	position: sticky;
	left: 0;
	background-color: #fff;
	z-index: 10;
	border-right: 2px solid #dee2e6;
	width: 160px;
	min-width: 160px;
	padding-left: 15px;
}

/* Header sticky col */
.situation-table th.sticky-col {
	background-color: #343a40;
	color: white;
	z-index: 21;
}

/* Sticky thead */
.situation-table thead {
	position: sticky;
	top: 0;
	z-index: 20;
}

.situation-table thead tr:first-child th {
	position: sticky;
	top: 0;
}

.situation-table thead tr:nth-child(2) th {
	position: sticky;
	top: 37px; /* Height of first header row */
}

/* Footer sticky col */
.situation-table tfoot th.sticky-col {
	background-color: #e9ecef;
	color: #333;
	z-index: 11;
}

/* General Cell Styling */
.situation-table th, .situation-table td {
	padding: 8px 10px;
	border-bottom: 1px solid #dee2e6;
	border-right: 1px solid #f1f3f5;
	vertical-align: middle;
}

.situation-table th {
	background-color: #343a40;
	color: white;
	text-align: left;
	white-space: nowrap;
}

/* Group Headers */
.situation-table .header-group {
	text-align: center;
	background-color: #495057;
}

.situation-table .header-group-understanding {
	text-align: center;
	background-color: #17a2b8;
}

.situation-table .header-group-ease {
	text-align: center;
	background-color: #6f42c1;
}

/* Compact Progress Bar Visualization */
.situation-table .viz-cell {
	width: 110px;
	min-width: 110px;
}

.situation-table .single-val-cell {
	width: 70px;
	min-width: 70px;
}

/* Brick-style rating visualization */
.situation-table .brick-row {
	display: flex;
	align-items: center;
	gap: 2px;
	margin-bottom: 2px;
	height: 8px;
}

.situation-table .single-brick-row {
	display: flex;
	align-items: center;
	gap: 2px;
	height: 12px;
}

.situation-table .brick {
	width: 15px;
	height: 100%;
	border-radius: 2px;
	background-color: #e9ecef;
}

.situation-table .brick.active-pre {
	background-color: #7FDBFF;
}

.situation-table .brick.active-post {
	background-color: #28a745;
}

.situation-table .brick.active-understanding {
	background-color: #17a2b8;
}

.situation-table .brick.active-ease {
	background-color: #6f42c1;
}

.situation-table .val-text {
	font-size: 10px;
	color: #666;
	width: 15px;
	text-align: right;
}

/* Delta Indicators */
.situation-table .delta {
	font-size: 10px;
	font-weight: bold;
	display: block;
	text-align: right;
	margin-top: 2px;
}

.situation-table .pos {
	color: green;
}

.situation-table .neg {
	color: red;
}

.situation-table .neu {
	color: #999;
}

/* Summary Footer Styling */
.situation-table tfoot tr {
	background-color: #e9ecef;
	font-weight: bold;
	border-top: 2px solid #333;
}

.situation-table .summary-val {
	font-size: 1.1em;
	text-align: center;
}

/* Student info styling */
.situation-table .student-name {
	font-weight: bold;
	display: block;
}

.situation-table .student-meta {
	display: block;
	font-size: 10px;
}

.situation-table .student-id {
	color: #666;
}

.situation-table .student-cohort {
	color: #17a2b8;
	font-weight: 500;
	margin-left: 8px;
}

.situation-table .student-totals {
	display: block;
	font-size: 10px;
	margin-top: 2px;
}

.situation-table .student-total-label {
	color: #666;
	margin-right: 2px;
}

.situation-table .student-total-value {
	font-weight: bold;
	margin-right: 8px;
}

.situation-table .student-total-value.pos {
	color: green;
}

.situation-table .student-total-value.neg {
	color: red;
}

.situation-table .student-total-value.neu {
	color: #999;
}

/* Total Summary Section */
.total-summary {
	display: flex;
	gap: 40px;
	margin-top: 20px;
	padding: 15px 20px;
	background-color: #f8f9fa;
	border-radius: 8px;
	border: 1px solid #dee2e6;
}

.total-summary-item {
	display: flex;
	align-items: center;
	gap: 10px;
}

.total-summary-label {
	font-weight: 600;
	color: #495057;
}

.total-summary-value {
	font-size: 1.5em;
	font-weight: bold;
}

.total-summary-value.pos {
	color: green;
}

.total-summary-value.neg {
	color: red;
}

.total-summary-value.neu {
	color: #999;
}

/* Text Answer Columns */
.situation-table .text-cell {
	min-width: 180px;
	max-width: 250px;
	white-space: normal;
	font-size: 11px;
	vertical-align: top;
	padding: 6px 8px;
}

.situation-table .text-cell-pre {
	background-color: #e3f2fd; /* Light blue */
}

.situation-table .text-cell-post {
	background-color: #e8f5e9; /* Light green */
}

.situation-table .header-text-pre {
	background-color: #2196f3; /* Blue */
	text-align: center;
	min-width: 180px;
}

.situation-table .header-text-post {
	background-color: #4caf50; /* Green */
	text-align: center;
	min-width: 180px;
}

.situation-table .header-group-text-pre {
	text-align: center;
	background-color: #1976d2;
}

.situation-table .header-group-text-post {
	text-align: center;
	background-color: #388e3c;
}

/* Question number styling in headers */
.situation-table th .question-number {
	display: block;
	font-size: 9px;
	font-weight: normal;
	opacity: 0.8;
	margin-top: 2px;
}

/* Cursor pointer for tooltip headers */
.situation-table th[data-bs-toggle="tooltip"] {
	cursor: help;
}
</style>
</wicket:head>
</head>
<body>
	<wicket:panel>

		<h3>Class Analysis: Situation-by-Situation</h3>
		<p>
			<em>Horizontal scroll enabled. Speaking: Pre (Gray) vs Post (Green). Understanding: Pre Q9 (Blue).
				Ease: Post Q7 Inv (Purple).</em>
		</p>

		<div class="situation-table-wrapper">
			<table class="situation-table">
				<thead>
					<!-- Group header row -->
					<tr>
						<th class="sticky-col" rowspan="2">Student</th>
						<th colspan="11" class="header-group" wicket:id="speakingGroupHeader">Speaking Confidence (Q7)
							&rarr; Ability (Q6)</th>
						<th colspan="11" class="header-group-understanding" wicket:id="understandingGroupHeader">Understanding
							(Q9)</th>
						<th colspan="11" class="header-group-ease" wicket:id="easeGroupHeader">Ease (Q7 Inv)</th>
						<th colspan="5" class="header-group-text-pre" wicket:id="textPreGroupHeader">Pre-Survey Text
							Answers</th>
						<th colspan="8" class="header-group-text-post" wicket:id="textPostGroupHeader">Post-Survey Text
							Answers</th>
					</tr>
					<!-- Situation names row -->
					<tr>
						<!-- Speaking situation headers -->
						<th wicket:id="speakingHeaders">
							<span wicket:id="situationName"></span> <span class="question-number" wicket:id="questionNumber"></span>
						</th>
						<!-- Understanding situation headers -->
						<th wicket:id="understandingHeaders">
							<span wicket:id="situationName"></span> <span class="question-number" wicket:id="questionNumber"></span>
						</th>
						<!-- Ease situation headers -->
						<th wicket:id="easeHeaders">
							<span wicket:id="situationName"></span> <span class="question-number" wicket:id="questionNumber"></span>
						</th>
						<!-- Text answer column headers -->
						<th wicket:id="textHeaders">
							<span wicket:id="headerLabel"></span>
						</th>
					</tr>
				</thead>
				<tbody>
					<tr wicket:id="studentRows">
						<!-- Student identity cell -->
						<td class="sticky-col">
							<span class="student-name" wicket:id="studentName"></span> <span class="student-meta"> <span
								class="student-id">ID: <span wicket:id="studentId"></span></span> <span class="student-cohort"
								wicket:id="studentCohort"></span>
							</span> <span class="student-totals"> <span class="student-total-label">S:</span><span
								class="student-total-value" wicket:id="studentSpeakingTotal"></span>
							</span>
						</td>

						<!-- Speaking situation cells (pre/post comparison) -->
						<td class="viz-cell" wicket:id="speakingCells">
							<div class="brick-row">
								<div class="brick" wicket:id="preBricks"></div>
								<span class="val-text" wicket:id="preVal"></span>
							</div>
							<div class="brick-row">
								<div class="brick" wicket:id="postBricks"></div>
								<span class="val-text" wicket:id="postVal"></span>
							</div>
							<span class="delta" wicket:id="delta"></span>
						</td>

						<!-- Understanding situation cells (single value) -->
						<td class="single-val-cell" wicket:id="understandingCells">
							<div class="single-brick-row">
								<div class="brick" wicket:id="bricks"></div>
								<span class="val-text" wicket:id="val"></span>
							</div>
						</td>

						<!-- Ease situation cells (single value) -->
						<td class="single-val-cell" wicket:id="easeCells">
							<div class="single-brick-row">
								<div class="brick" wicket:id="bricks"></div>
								<span class="val-text" wicket:id="val"></span>
							</div>
						</td>

						<!-- Text answer cells -->
						<td class="text-cell" wicket:id="textCells">
							<span wicket:id="textValue"></span>
						</td>
					</tr>
				</tbody>
				<tfoot>
					<tr>
						<th class="sticky-col">Avg</th>
						<!-- Speaking averages (deltas) -->
						<td class="summary-val" wicket:id="speakingAverages">
							<span wicket:id="avgValue"></span>
						</td>
						<!-- Understanding averages (values) -->
						<td class="summary-val" wicket:id="understandingAverages">
							<span wicket:id="avgValue"></span>
						</td>
						<!-- Ease averages (values) -->
						<td class="summary-val" wicket:id="easeAverages">
							<span wicket:id="avgValue"></span>
						</td>
					</tr>
				</tfoot>
			</table>
		</div>

		<!-- Total Change Summary -->
		<div class="total-summary">
			<div class="total-summary-item">
				<span class="total-summary-label">Speaking Confidence (Q7) &rarr; Ability (Q6) Total Change:</span> <span
					class="total-summary-value" wicket:id="totalSpeakingChange"></span>
			</div>
		</div>

		<div class="container mt-5">
			<div wicket:id="improvementSummary"></div>
			<div wicket:id="ratingDistribution"></div>
		</div>
	</wicket:panel>
</body>
</html>
